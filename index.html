<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milimar JAGC | Oficina Virtual</title>
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo Aurora OSCURO */
        body {
            background: linear-gradient(125deg, #0a0f1a 0%, #0f2a3a 35%, #1a3f3a 70%, #4a3a1a 100%);
            background-size: 400% 400%;
            animation: aurora 15s ease infinite;
            font-family: 'Inter', sans-serif;
        }
        @keyframes aurora {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        h1, h2, h3, .font-display {
            font-family: 'Poppins', sans-serif;
            font-weight: 900;
            letter-spacing: -0.02em;
        }
        .glass-card {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        .node {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            transition: 0.3s;
            margin: 0 4px;
            font-family: 'Poppins', sans-serif;
        }
        .node-filled {
            background: linear-gradient(145deg, #fbbf24, #f59e0b);
            color: black;
            border: 2px solid white;
            box-shadow: 0 0 20px #fbbf24;
        }
        .node-empty {
            border: 2px dashed rgba(255, 215, 0, 0.3);
            color: rgba(255, 255, 255, 0.5);
            background: transparent;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            transition: opacity 0.3s;
            max-width: 300px;
        }
        .btn {
            @apply font-black py-3 px-6 rounded-xl transition-all transform hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed;
            font-family: 'Poppins', sans-serif;
        }
        .tutorial-step, .benefit-step, .feed-item {
            @apply bg-white/10 p-3 rounded-lg mb-2 text-sm border border-white/20;
        }
        .telegram-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 50;
            background: linear-gradient(145deg, #2AABEE, #229ED9);
            padding: 12px 24px;
            border-radius: 50px;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 20px rgba(42, 171, 238, 0.5);
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            border: 1px solid rgba(255,255,255,0.3);
            text-decoration: none;
        }
        .telegram-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(42, 171, 238, 0.7);
        }
        .tab-button {
            @apply px-6 py-3 rounded-t-xl font-bold transition-all;
        }
        .tab-active {
            @apply bg-yellow-500 text-black;
        }
        .tab-inactive {
            @apply bg-white/10 text-white hover:bg-white/20;
        }
        .feed-container {
            max-height: 200px;
            overflow-y: auto;
        }
        .vault-card {
            @apply glass-card p-4 text-center;
        }
        .vault-stat {
            @apply text-2xl font-black text-yellow-300;
        }
    </style>
</head>
<body class="text-white antialiased p-4 min-h-screen relative">

    <!-- Bot√≥n flotante de Telegram -->
    <a id="telegramLink" href="https://t.me/+z7wwfx0ocho1NzI5" target="_blank" class="telegram-button hidden">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69.01-.03.02-.15-.05-.22-.07-.07-.18-.05-.26-.03-.11.02-1.85 1.17-5.22 3.45-.5.34-.95.5-1.36.49-.45-.01-1.3-.25-1.94-.46-.78-.26-1.4-.4-1.35-.85.03-.23.27-.47.74-.72 2.91-1.27 4.86-2.11 5.83-2.52 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.08-.02.25-.04.4z"/></svg>
        <span>Grupo Oficial Milimar</span>
    </a>

    <div id="toast" class="toast glass-card p-4 hidden">
        <p id="toastMsg" class="text-sm"></p>
    </div>

    <div class="max-w-3xl mx-auto">
        <header class="text-center py-8">
            <div class="flex items-center justify-center gap-4">
                <h1 class="text-6xl font-black text-white drop-shadow-2xl tracking-tighter" style="text-shadow: 0 0 20px rgba(251,191,36,0.5);">MILIMAR JAGC</h1>
            </div>
            <p class="text-sm text-white/80 uppercase tracking-[0.3em] font-light mt-2">Oficina Virtual ¬∑ BSC</p>
        </header>

        <!-- Pesta√±as de navegaci√≥n -->
        <div class="flex justify-center gap-2 mb-6">
            <button id="btnMembresia" class="tab-button tab-active">MEMBRES√çA</button>
            <button id="btnVault" class="tab-button tab-inactive">VAULT (INVERSI√ìN)</button>
            <button id="btnArbitraje" class="tab-button tab-inactive">ARBITRAJE</button>
        </div>

        <!-- Contenedor de conexi√≥n (visible cuando no hay wallet) -->
        <div id="conBox" class="glass-card p-10 text-center mb-6">
            <button id="btnConnect" class="btn bg-white text-black w-full max-w-md mx-auto hover:bg-yellow-300 transition">CONECTAR BILLETERA</button>
        </div>

        <!-- SECCI√ìN MEMBRES√çA (visible por defecto) -->
        <div id="seccionMembresia" class="space-y-6">
            <!-- Aqu√≠ va todo el dashboard de membres√≠a (igual que antes) -->
            <!-- ... (resumido por brevedad, pero en el c√≥digo final debe estar completo) ... -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <div class="glass-card p-4 border-l-4 border-green-400">
                    <p class="text-[10px] text-white/60 uppercase font-bold">Saldo Pendiente</p>
                    <p id="valSaldo" class="text-xl font-black text-green-300">0.00</p>
                </div>
                <div class="glass-card p-4 border-r-4 border-yellow-400 text-right">
                    <p class="text-[10px] text-white/60 uppercase font-bold">Red Total</p>
                    <p id="valRed" class="text-xl font-black text-yellow-300">0</p>
                </div>
                <div class="glass-card p-4 border-l-4 border-blue-400">
                    <p class="text-[10px] text-white/60 uppercase font-bold">Directos</p>
                    <p id="valDir" class="text-xl font-black text-blue-300">0</p>
                </div>
                <div class="glass-card p-4 border-r-4 border-purple-400 text-right">
                    <p class="text-[10px] text-white/60 uppercase font-bold">D√≠as activo</p>
                    <p id="valDias" class="text-xl font-black text-purple-300">0</p>
                </div>
            </div>
            <!-- ... resto de la secci√≥n membres√≠a (fondos, niveles, admin, etc.) ... -->
        </div>

        <!-- SECCI√ìN VAULT (oculta inicialmente) -->
        <div id="seccionVault" class="hidden space-y-6">
            <div class="glass-card p-6">
                <h2 class="text-2xl font-bold text-yellow-400 mb-4">üè¶ VAULT DE CRECIMIENTO</h2>
                <p class="text-sm text-white/70 mb-6">Invierte desde $10 USDT en nuestro fondo diversificado (70% pr√©stamos seguros + 30% farming de alto rendimiento). Gana intereses semanales y retira cuando quieras.</p>

                <!-- Estad√≠sticas del vault -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                    <div class="vault-card">
                        <p class="text-[10px] text-white/50">Mi inversi√≥n</p>
                        <p id="vaultMiInversion" class="vault-stat">0.00</p>
                    </div>
                    <div class="vault-card">
                        <p class="text-[10px] text-white/50">Ganancias acumuladas</p>
                        <p id="vaultGanancias" class="vault-stat">0.00</p>
                    </div>
                    <div class="vault-card">
                        <p class="text-[10px] text-white/50">Total en fondo</p>
                        <p id="vaultTotalFondo" class="vault-stat">0.00</p>
                    </div>
                    <div class="vault-card">
                        <p class="text-[10px] text-white/50">Valor de share</p>
                        <p id="vaultSharePrice" class="vault-stat">1.00</p>
                    </div>
                </div>

                <!-- Proyecciones atractivas -->
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="glass-card p-3">
                        <p class="text-xs text-white/60">Ganancia semanal estimada (con $100)</p>
                        <p class="text-lg font-bold text-green-300">$0.30 ‚Äì $0.40</p>
                    </div>
                    <div class="glass-card p-3">
                        <p class="text-xs text-white/60">Ganancia mensual estimada (con $100)</p>
                        <p class="text-lg font-bold text-green-300">$1.20 ‚Äì $1.60</p>
                    </div>
                </div>

                <!-- Formulario de dep√≥sito -->
                <div class="glass-card p-4 mb-4">
                    <h3 class="font-bold text-white mb-2">üì• Depositar USDT</h3>
                    <div class="flex gap-2">
                        <input type="number" id="vaultDepositAmount" placeholder="Cantidad (m√≠n. 10)" min="10" step="0.01" class="w-full bg-white/10 border border-white/30 rounded-lg p-2 text-white">
                        <button id="btnVaultDeposit" class="btn bg-green-600 text-white px-6">Depositar</button>
                    </div>
                    <p class="text-[10px] text-white/30 mt-1">M√≠nimo 10 USDT. Las ganancias se reparten semanalmente.</p>
                </div>

                <!-- Opciones de retiro -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="glass-card p-4">
                        <h3 class="font-bold text-white mb-2">üì§ Retiro est√°ndar</h3>
                        <p class="text-xs text-white/60 mb-2">Sin comisi√≥n. Se procesa al final del ciclo (semanal).</p>
                        <div class="flex gap-2">
                            <input type="number" id="vaultWithdrawStandard" placeholder="Cantidad de shares" min="0" step="1" class="w-full bg-white/10 border border-white/30 rounded-lg p-2 text-white">
                            <button id="btnVaultRequestStandard" class="btn bg-blue-600 text-white px-4">Solicitar</button>
                        </div>
                    </div>
                    <div class="glass-card p-4">
                        <h3 class="font-bold text-white mb-2">‚ö° Retiro instant√°neo</h3>
                        <p class="text-xs text-white/60 mb-2">Comisi√≥n 1%. L√≠mite semanal del 10% del fondo.</p>
                        <div class="flex gap-2">
                            <input type="number" id="vaultWithdrawInstant" placeholder="Cantidad de shares" min="0" step="1" class="w-full bg-white/10 border border-white/30 rounded-lg p-2 text-white">
                            <button id="btnVaultInstant" class="btn bg-yellow-500 text-black px-4">Retirar</button>
                        </div>
                    </div>
                </div>

                <!-- Feed de actividad del vault -->
                <div class="glass-card p-4 mt-6">
                    <h3 class="text-white font-bold text-sm mb-2">üì¢ ACTIVIDAD DEL VAULT</h3>
                    <div id="vaultFeed" class="feed-container space-y-2 pr-2">
                        <p class="text-white/50 text-xs">Conecta tu wallet para ver la actividad...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN ARBITRAJE (pr√≥ximamente) -->
        <div id="seccionArbitraje" class="hidden space-y-6">
            <div class="glass-card p-6 text-center">
                <h2 class="text-2xl font-bold text-yellow-400 mb-4">ü§ñ ARBITRAJE</h2>
                <p class="text-sm text-white/70 mb-6">Estamos desarrollando una plataforma de arbitraje automatizado para maximizar tus ganancias. ¬°Muy pronto!</p>
                <div class="bg-yellow-500/20 border border-yellow-500 rounded-lg p-4">
                    <p class="text-yellow-300 font-bold">üöß EN DESARROLLO</p>
                    <p class="text-xs text-white/70 mt-2">Mientras tanto, puedes usar el Vault de Crecimiento para generar ingresos pasivos.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // üü¢ CONFIGURACI√ìN (ACTUALIZA CON TUS DIRECCIONES)
        const CONTRACT_ADDR_MEMBRESIA = "0x497D328d5d59E191Eb7FC411a876CefB8B43176c"; // Milimar v4
        const CONTRACT_ADDR_VAULT = "0x..."; // Direcci√≥n del vault (actualizar despu√©s del despliegue)
        const USDT_ADDR = "0x55d398326f99059fF775485246999027B3197955";
        const BSC_CHAIN_ID = 56;
        const TELEGRAM_GRUPO = "https://t.me/+z7wwfx0ocho1NzI5";

        // ABIs (simplificados para el ejemplo; en producci√≥n usar los completos)
        const abiMembresia = [
            "function consultarEstado(address) view returns (uint256,uint256,uint256,uint256,uint256,uint256,bool)",
            "function unirse(address)",
            "function renovarSuscripcion()",
            "function retirarGanancias()",
            "function verDetalleRed(address) view returns (uint256[5] memory)",
            "function verDetalleGanancias(address) view returns (uint256[5] memory)",
            "function admin() view returns (address)",
            "function togglePausa()",
            "function otorgarCuposExtra(address,uint256)",
            "function premiarLider(address,uint256)",
            "function recuperarTokenExterno(address,uint256)",
            "function fondoSolidaridad() view returns (uint256)",
            "function poolLiderazgo() view returns (uint256)",
            "function emergencyMode() view returns (bool)",
            "function emergencyWithdraw()",
            "event RegistroGlobal(address indexed usuario, address indexed patrocinador, uint256 fecha)",
            "event BonoNivel3Alcanzado(address indexed usuario, uint256 fecha)",
            "event RetiroExitoso(address indexed usuario, uint256 monto)",
            "event PremiadoLider(address indexed lider, uint256 monto)"
        ];

        const abiVault = [
            "function deposit(uint256 amount) external",
            "function requestStandardWithdraw(uint256 shares) external",
            "function instantWithdraw(uint256 shares) external",
            "function balanceOf(address) view returns (uint256)",
            "function pendingRewards(address) view returns (uint256)",
            "function totalAssets() view returns (uint256)",
            "function totalShares() view returns (uint256)",
            "function sharePrice() view returns (uint256)",
            "function getVaultInfo() view returns (uint256,uint256,uint256,uint256,uint256,uint256,bool,uint256,uint256,uint256,uint256,uint256,uint256,address)",
            "event Deposited(address indexed user, uint256 amount, uint256 shares, uint256 timestamp)",
            "event WithdrawnStandard(address indexed user, uint256 amount, uint256 shares, uint256 timestamp)",
            "event WithdrawnInstant(address indexed user, uint256 amount, uint256 shares, uint256 fee, uint256 timestamp)",
            "event ProfitDistributed(uint256 totalProfit, uint256 fee, uint256 timestamp)"
        ];

        const usdtAbi = ["function approve(address spender, uint256 amount) returns (bool)"];

        // Estado
        let provider, signer, userAddress, contractMembresia, contractVault, usdtContract;
        let isAdmin = false;
        let toastTimeout;

        // Elementos DOM
        const toast = document.getElementById('toast');
        const toastMsg = document.getElementById('toastMsg');
        const telegramLink = document.getElementById('telegramLink');
        const btnConnect = document.getElementById('btnConnect');
        const conBox = document.getElementById('conBox');
        const seccionMembresia = document.getElementById('seccionMembresia');
        const seccionVault = document.getElementById('seccionVault');
        const seccionArbitraje = document.getElementById('seccionArbitraje');
        const btnMembresia = document.getElementById('btnMembresia');
        const btnVault = document.getElementById('btnVault');
        const btnArbitraje = document.getElementById('btnArbitraje');
        const vaultFeed = document.getElementById('vaultFeed');

        // Funciones de utilidad
        function showToast(msg, isError = false) {
            clearTimeout(toastTimeout);
            toast.classList.remove('hidden');
            toastMsg.innerText = msg;
            toast.style.backgroundColor = isError ? 'rgba(127,29,29,0.9)' : 'rgba(6,78,59,0.9)';
            toastTimeout = setTimeout(() => toast.classList.add('hidden'), 4000);
        }

        // Cambio de pesta√±as
        btnMembresia.addEventListener('click', () => {
            btnMembresia.classList.add('tab-active');
            btnMembresia.classList.remove('tab-inactive');
            btnVault.classList.add('tab-inactive');
            btnVault.classList.remove('tab-active');
            btnArbitraje.classList.add('tab-inactive');
            btnArbitraje.classList.remove('tab-active');
            seccionMembresia.classList.remove('hidden');
            seccionVault.classList.add('hidden');
            seccionArbitraje.classList.add('hidden');
        });

        btnVault.addEventListener('click', () => {
            btnVault.classList.add('tab-active');
            btnVault.classList.remove('tab-inactive');
            btnMembresia.classList.add('tab-inactive');
            btnMembresia.classList.remove('tab-active');
            btnArbitraje.classList.add('tab-inactive');
            btnArbitraje.classList.remove('tab-active');
            seccionMembresia.classList.add('hidden');
            seccionVault.classList.remove('hidden');
            seccionArbitraje.classList.add('hidden');
            if (userAddress) cargarDatosVault();
        });

        btnArbitraje.addEventListener('click', () => {
            btnArbitraje.classList.add('tab-active');
            btnArbitraje.classList.remove('tab-inactive');
            btnMembresia.classList.add('tab-inactive');
            btnMembresia.classList.remove('tab-active');
            btnVault.classList.add('tab-inactive');
            btnVault.classList.remove('tab-active');
            seccionMembresia.classList.add('hidden');
            seccionVault.classList.add('hidden');
            seccionArbitraje.classList.remove('hidden');
        });

        // Funci√≥n para agregar al feed del vault
        function agregarAlFeedVault(mensaje, tipo = 'info') {
            const item = document.createElement('div');
            item.className = `feed-item border-l-4 ${tipo === 'deposit' ? 'border-green-500' : tipo === 'withdraw' ? 'border-yellow-500' : 'border-blue-500'}`;
            item.innerHTML = `<p class="text-xs text-white/80">${mensaje}</p>`;
            vaultFeed.prepend(item);
            if (vaultFeed.children.length > 20) {
                vaultFeed.removeChild(vaultFeed.lastChild);
            }
        }

        // Funci√≥n para cargar datos del vault
        async function cargarDatosVault() {
            if (!contractVault || !userAddress) return;
            try {
                const miInversion = await contractVault.balanceOf(userAddress);
                const ganancias = await contractVault.pendingRewards(userAddress);
                const totalAssets = await contractVault.totalAssets();
                const sharePrice = await contractVault.sharePrice();
                document.getElementById('vaultMiInversion').innerText = ethers.utils.formatUnits(miInversion, 18);
                document.getElementById('vaultGanancias').innerText = ethers.utils.formatUnits(ganancias, 18);
                document.getElementById('vaultTotalFondo').innerText = ethers.utils.formatUnits(totalAssets, 18);
                document.getElementById('vaultSharePrice').innerText = ethers.utils.formatUnits(sharePrice, 18);
            } catch (e) {
                console.error("Error cargando vault:", e);
            }
        }

        // Funci√≥n para conectar wallet
        async function connect() {
            if (!window.ethereum) return showToast('Instala MetaMask/OKX Wallet', true);
            try {
                provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();

                // Verificar red
                const network = await provider.getNetwork();
                if (network.chainId !== BSC_CHAIN_ID) {
                    try {
                        await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }] });
                    } catch {
                        showToast('Cambia a BSC Mainnet en tu wallet', true);
                        return;
                    }
                }

                // Instanciar contratos
                contractMembresia = new ethers.Contract(CONTRACT_ADDR_MEMBRESIA, abiMembresia, signer);
                contractVault = new ethers.Contract(CONTRACT_ADDR_VAULT, abiVault, signer);
                usdtContract = new ethers.Contract(USDT_ADDR, usdtAbi, signer);

                // Ocultar caja de conexi√≥n, mostrar secciones
                conBox.classList.add('hidden');
                seccionMembresia.classList.remove('hidden');
                telegramLink.classList.remove('hidden');

                // Cargar datos de membres√≠a (simulado, aqu√≠ ir√≠an las llamadas reales)
                // ...

                // Cargar datos del vault si estamos en esa pesta√±a
                if (!seccionVault.classList.contains('hidden')) {
                    cargarDatosVault();
                }

                // Escuchar eventos del vault
                contractVault.on("Deposited", (user, amount, shares, timestamp) => {
                    agregarAlFeedVault(`üì• Dep√≥sito de ${ethers.utils.formatUnits(amount, 18)} USDT por ${user.slice(0,6)}...${user.slice(-4)}`, 'deposit');
                });
                contractVault.on("WithdrawnStandard", (user, amount, shares, timestamp) => {
                    agregarAlFeedVault(`üì§ Retiro est√°ndar de ${ethers.utils.formatUnits(amount, 18)} USDT por ${user.slice(0,6)}...${user.slice(-4)}`, 'withdraw');
                });
                contractVault.on("WithdrawnInstant", (user, amount, shares, fee, timestamp) => {
                    agregarAlFeedVault(`‚ö° Retiro instant√°neo de ${ethers.utils.formatUnits(amount, 18)} USDT (comisi√≥n ${ethers.utils.formatUnits(fee, 18)}) por ${user.slice(0,6)}...${user.slice(-4)}`, 'withdraw');
                });
                contractVault.on("ProfitDistributed", (totalProfit, fee, timestamp) => {
                    agregarAlFeedVault(`üí∞ Distribuci√≥n de ganancias: total $${ethers.utils.formatUnits(totalProfit, 18)} USDT`, 'profit');
                });

            } catch (e) {
                showToast('Error conectando: ' + e.message, true);
            }
        }

        btnConnect.onclick = connect;

        // Botones del vault
        document.getElementById('btnVaultDeposit').addEventListener('click', async () => {
            const amount = document.getElementById('vaultDepositAmount').value;
            if (!amount || parseFloat(amount) < 10) return showToast('Monto m√≠nimo 10 USDT', true);
            try {
                const amountWei = ethers.utils.parseUnits(amount, 18);
                // Primero aprobar USDT
                const approveTx = await usdtContract.approve(CONTRACT_ADDR_VAULT, amountWei);
                await approveTx.wait();
                // Luego depositar
                const tx = await contractVault.deposit(amountWei);
                showToast('Depositando...');
                await tx.wait();
                showToast('‚úÖ Dep√≥sito exitoso');
                cargarDatosVault();
            } catch (e) {
                showToast('Error: ' + e.message, true);
            }
        });

        document.getElementById('btnVaultRequestStandard').addEventListener('click', async () => {
            const shares = document.getElementById('vaultWithdrawStandard').value;
            if (!shares || parseFloat(shares) <= 0) return showToast('Cantidad inv√°lida', true);
            try {
                const sharesWei = ethers.utils.parseUnits(shares, 18);
                const tx = await contractVault.requestStandardWithdraw(sharesWei);
                showToast('Solicitando retiro est√°ndar...');
                await tx.wait();
                showToast('‚úÖ Solicitud registrada. Se procesar√° al final del ciclo.');
                cargarDatosVault();
            } catch (e) {
                showToast('Error: ' + e.message, true);
            }
        });

        document.getElementById('btnVaultInstant').addEventListener('click', async () => {
            const shares = document.getElementById('vaultWithdrawInstant').value;
            if (!shares || parseFloat(shares) <= 0) return showToast('Cantidad inv√°lida', true);
            try {
                const sharesWei = ethers.utils.parseUnits(shares, 18);
                const tx = await contractVault.instantWithdraw(sharesWei);
                showToast('Retirando instant√°neamente...');
                await tx.wait();
                showToast('‚úÖ Retiro instant√°neo completado');
                cargarDatosVault();
            } catch (e) {
                showToast('Error: ' + e.message, true);
            }
        });

        // Auto-conectar si ya hay wallet
        window.addEventListener('load', () => {
            if (window.ethereum && window.ethereum.selectedAddress) connect();
        });
    </script>
    <footer class="text-center text-[10px] text-gray-500 mt-4">Milimar Protocol ¬∑ BSC ¬∑ Versi√≥n 4 + Vault</footer>
</body>
</html>
